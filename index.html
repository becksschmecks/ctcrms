<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8" />
<title>R√§tsel-Adventskalender</title>
<style>
body {
  font-family: Arial, sans-serif;
  max-width: 600px;
  margin: auto;
  padding: 20px;
}
#calendar {
  display: grid;
  grid-template-columns: repeat(4, 1fr);
  gap: 10px;
}
.day {
  padding: 20px;
  background: #ddd;
  text-align: center;
  cursor: pointer;
  border-radius: 6px;
}
.disabled {
  opacity: 0.3;
  pointer-events: none;
}
.answer-btn {
  display: block;
  margin: 8px 0;
  padding: 10px;
  background: #eee;
  border: 1px solid #ccc;
  border-radius: 4px;
  cursor: pointer;
}
#leaderboard {
  margin-top: 30px;
}
</style>
</head>
<body>

<h1>üéÑ R√§tsel-Adventskalender</h1>

<div id="name-input">
  <p>Bitte gib deinen Spielernamen ein:</p>
  <input id="playername" type="text" />
  <button onclick="saveName()">Speichern</button>
</div>

<div id="calendar" style="display:none"></div>

<div id="question-container" style="display:none">
  <h2>Welche Katze war‚Äôs heute?</h2>
  <div id="answers"></div>
</div>

<h2>üèÜ Leaderboard</h2>
<div id="leaderboard"></div>

<script>
const API_URL = "https://script.google.com/macros/s/AKfycbxvChp7hlwEzNbol_IT0LZ5u0FwWcYLMXmA3QZRFIbmT-o7LiwvaxI-8v9QQ5o_tQ0/exec"; 

function saveName() {
  const name = document.getElementById("playername").value.trim();
  if (!name) return alert("Bitte Namen eingeben!");
  localStorage.setItem("playername", name);
  location.reload();
}

function init() {
  const name = localStorage.getItem("playername");
  if (!name) return;

  document.getElementById("name-input").style.display = "none";
  document.getElementById("calendar").style.display = "grid";

  renderCalendar();
  loadLeaderboard();
}

function renderCalendar() {
  const cal = document.getElementById("calendar");
  cal.innerHTML = "";

  const today = new Date();
  const currentDay = today.getDate();

  for (let d = 1; d <= 24; d++) {
    const div = document.createElement("div");
    div.className = "day";
    div.textContent = d;

    if (d > currentDay) div.classList.add("disabled");

    div.onclick = () => openDay(d);
    cal.appendChild(div);
  }
}

async function openDay(day) {
  document.getElementById("question-container").style.display = "block";

  const answersDiv = document.getElementById("answers");
  answersDiv.innerHTML = "";

  const options = ["A","B","C","D","E","F"];

  options.forEach(opt => {
    const btn = document.createElement("button");
    btn.className = "answer-btn";
    btn.textContent = opt;
    btn.onclick = () => submitAnswer(day, opt);
    answersDiv.appendChild(btn);
  });
}

async function submitAnswer(day, option) {
  const name = localStorage.getItem("playername");

  const solRes = await fetch(`${API_URL}?action=solution&day=${day}`);
  const sol = await solRes.json();

  const correct = sol.correct === option;

  alert(correct ? "üéâ Richtig!" : "‚ùå Falsch!");

  await fetch(API_URL, {
    method: "POST",
    body: JSON.stringify({
      name,
      day,
      correct
    })
  });

  loadLeaderboard();
}

async function loadLeaderboard() {
  const res = await fetch(`${API_URL}?action=leaderboard`);
  const data = await res.json();

  const lb = document.getElementById("leaderboard");
  lb.innerHTML = "";

  data.forEach((entry, i) => {
    lb.innerHTML += `${i+1}. ${entry.name}: ${entry.points} Punkte<br>`;
  });
}

init();
</script>
</body>
</html>